<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 2rem;
        }

        .container {
            text-align: center;
            background: white;
            padding: 2.5rem 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        p {
            font-size: 1.2rem;
            color: #666;
        }

        .game-section {
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: 2px solid #eee;
            text-align: center;
        }

        #basketballCanvas {
            border: 3px solid #f59e0b;
            border-radius: 12px;
            background: linear-gradient(180deg, #0b172a 0%, #0f2038 100%);
            display: block;
            margin: 1rem auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .game-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 0.5rem;
            font-weight: 700;
            color: #f59e0b;
        }

        .control-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 0.8rem;
            flex-wrap: wrap;
            color: #444;
        }

        .control-row button {
            padding: 0.75rem 1.6rem;
            border: none;
            border-radius: 999px;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: white;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .control-row button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);
        }

        .control-row button:active {
            transform: translateY(0);
        }

        .instructions {
            margin-top: 0.5rem;
            font-size: 0.95rem;
            color: #666;
        }

        /* DSE Math Calculator */
        .calc-section {
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: 2px solid #eee;
            text-align: left;
        }

        .calc-title {
            text-align: center;
            color: #2563eb;
            margin-bottom: 1rem;
        }

        .calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .calc-card {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
            background: #fafafa;
        }

        .calc-card h3 {
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .calc-label {
            display: block;
            margin: 0.5rem 0 0.25rem;
            font-weight: 600;
            color: #4b5563;
        }

        .calc-input {
            width: 100%;
            padding: 0.75rem 0.85rem;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.15s ease, box-shadow 0.15s ease;
        }

        .calc-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .calc-buttons {
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .calc-btn {
            padding: 0.6rem 0.9rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .calc-btn.secondary {
            background: #e5e7eb;
            color: #111827;
            box-shadow: none;
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(37, 99, 235, 0.4);
        }

        .calc-btn:active {
            transform: translateY(0);
        }

        .calc-output {
            margin-top: 0.6rem;
            background: #111827;
            color: #e5e7eb;
            padding: 0.75rem;
            border-radius: 10px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            min-height: 48px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hello World</h1>
        <p>Welcome to your first webpage!</p>

        <div class="game-section">
            <h2 style="color: #f59e0b; margin-bottom: 0.75rem;">Arcade Basketball</h2>
            <canvas id="basketballCanvas" width="640" height="420"></canvas>
            <div class="game-info">
                <div>Score: <span id="scoreValue">0</span></div>
                <div>Shots: <span id="shotsValue">0</span></div>
            </div>
            <div class="control-row">
                <span>Aim: click & drag, release to shoot</span>
                <button onclick="resetBall()">Reset Ball</button>
            </div>
            <p class="instructions">Tip: longer drags = more power; angle sets your arc.</p>
        </div>

        <div class="calc-section">
            <h2 class="calc-title">DSE Math Calculator</h2>
            <div class="calc-grid">
                <div class="calc-card">
                    <h3>General Calculator</h3>
                    <label class="calc-label" for="calcExpression">Expression</label>
                    <input id="calcExpression" class="calc-input" placeholder="e.g. 3*(5+2)^2 / 7" />
                    <div class="calc-buttons">
                        <button class="calc-btn" onclick="evaluateExpression()">Calculate</button>
                        <button class="calc-btn secondary" onclick="clearExpression()">Clear</button>
                    </div>
                    <div class="calc-output" id="calcResult">Result will appear here.</div>
                </div>

                <div class="calc-card">
                    <h3>Quadratic Solver</h3>
                    <label class="calc-label" for="quadA">a</label>
                    <input id="quadA" class="calc-input" type="number" value="1" step="any" />
                    <label class="calc-label" for="quadB">b</label>
                    <input id="quadB" class="calc-input" type="number" value="0" step="any" />
                    <label class="calc-label" for="quadC">c</label>
                    <input id="quadC" class="calc-input" type="number" value="0" step="any" />
                    <div class="calc-buttons">
                        <button class="calc-btn" onclick="solveQuadratic()">Solve</button>
                    </div>
                    <div class="calc-output" id="quadResult">Roots and discriminant will appear here.</div>
                </div>

                <div class="calc-card">
                    <h3>Combinatorics & Percent</h3>
                    <label class="calc-label" for="combN">n (items)</label>
                    <input id="combN" class="calc-input" type="number" value="5" />
                    <label class="calc-label" for="combR">r (choose)</label>
                    <input id="combR" class="calc-input" type="number" value="2" />
                    <label class="calc-label" for="percentBase">Base value</label>
                    <input id="percentBase" class="calc-input" type="number" value="100" step="any" />
                    <label class="calc-label" for="percentChange">% change (use negative for decrease)</label>
                    <input id="percentChange" class="calc-input" type="number" value="10" step="any" />
                    <div class="calc-buttons">
                        <button class="calc-btn" onclick="computeCombinatorics()">nCr / nPr</button>
                        <button class="calc-btn secondary" onclick="computePercentChange()">% Change</button>
                    </div>
                    <div class="calc-output" id="combResult">Results will appear here.</div>
                </div>

                <div class="calc-card">
                    <h3>Simultaneous Equations (聯立方程)</h3>
                    <p style="margin: 0 0 0.5rem; color: #4b5563; font-weight: 600;">Solve ax + by + c = 0 and dx + ey + f = 0</p>
                    <div class="calc-grid" style="grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 0.5rem;">
                        <div>
                            <label class="calc-label" for="simA">a</label>
                            <input id="simA" class="calc-input" type="number" value="1" step="any" />
                        </div>
                        <div>
                            <label class="calc-label" for="simB">b</label>
                            <input id="simB" class="calc-input" type="number" value="2" step="any" />
                        </div>
                        <div>
                            <label class="calc-label" for="simC">c</label>
                            <input id="simC" class="calc-input" type="number" value="3" step="any" />
                        </div>
                        <div>
                            <label class="calc-label" for="simD">d</label>
                            <input id="simD" class="calc-input" type="number" value="4" step="any" />
                        </div>
                        <div>
                            <label class="calc-label" for="simE">e</label>
                            <input id="simE" class="calc-input" type="number" value="5" step="any" />
                        </div>
                        <div>
                            <label class="calc-label" for="simF">f</label>
                            <input id="simF" class="calc-input" type="number" value="6" step="any" />
                        </div>
                    </div>
                    <div class="calc-buttons" style="margin-top: 1rem;">
                        <button class="calc-btn" onclick="solveSimultaneous()">Solve</button>
                        <button class="calc-btn secondary" onclick="clearSimultaneous()">Clear</button>
                    </div>
                    <div class="calc-output" id="simResult">Solutions x, y will appear here.</div>
                </div>

                <div class="calc-card">
                    <h3>Cubic Equation Solver (一元三次方程)</h3>
                    <p style="margin: 0 0 0.5rem; color: #4b5563; font-weight: 600;">Solve ax³ + bx² + cx + d = 0</p>
                    <label class="calc-label" for="cubicA">a</label>
                    <input id="cubicA" class="calc-input" type="number" value="1" step="any" />
                    <label class="calc-label" for="cubicB">b</label>
                    <input id="cubicB" class="calc-input" type="number" value="-6" step="any" />
                    <label class="calc-label" for="cubicC">c</label>
                    <input id="cubicC" class="calc-input" type="number" value="11" step="any" />
                    <label class="calc-label" for="cubicD">d</label>
                    <input id="cubicD" class="calc-input" type="number" value="-6" step="any" />
                    <div class="calc-buttons" style="margin-top: 1rem;">
                        <button class="calc-btn" onclick="solveCubic()">Solve</button>
                        <button class="calc-btn secondary" onclick="clearCubic()">Clear</button>
                    </div>
                    <div class="calc-output" id="cubicResult">Roots will appear here.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Arcade Basketball
        const canvas = document.getElementById('basketballCanvas');
        const ctx = canvas.getContext('2d');

        const gravity = 0.45;
        const groundY = canvas.height - 40;
        const ballRadius = 14;
        const startPos = { x: 110, y: groundY - ballRadius };

        const rim = {
            x: canvas.width - 160,
            y: canvas.height * 0.45,
            width: 70,
            thickness: 6
        };

        let ball = {
            x: startPos.x,
            y: startPos.y,
            vx: 0,
            vy: 0,
            inAir: false,
            dragging: false,
            lastY: startPos.y
        };

        let score = 0;
        let shots = 0;
        let justScored = false;

        function drawCourt() {
            // Sky background already set by canvas background
            // Court floor
            ctx.fillStyle = '#1b2f4a';
            ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

            // Hoop stand and backboard
            ctx.fillStyle = '#ddd';
            ctx.fillRect(rim.x + rim.width - 10, rim.y - 30, 8, 180);
            ctx.fillStyle = '#f8f8f8';
            ctx.fillRect(rim.x - 20, rim.y - 40, rim.width + 40, 30);

            // Rim
            ctx.fillStyle = '#f97316';
            ctx.fillRect(rim.x, rim.y, rim.width, rim.thickness);

            // Net hint
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(rim.x, rim.y + rim.thickness);
            ctx.lineTo(rim.x + rim.width / 2, rim.y + 22);
            ctx.lineTo(rim.x + rim.width, rim.y + rim.thickness);
            ctx.stroke();
        }

        function drawBall() {
            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#d97706';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ballRadius - 4, 0, Math.PI * 2);
            ctx.stroke();
        }

        function drawAimLine(mouseX, mouseY) {
            if (!ball.dragging) return;
            ctx.strokeStyle = 'rgba(255,255,255,0.7)';
            ctx.lineWidth = 2;
            ctx.setLineDash([6, 6]);
            ctx.beginPath();
            ctx.moveTo(ball.x, ball.y);
            ctx.lineTo(mouseX, mouseY);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function resetBall() {
            ball.x = startPos.x;
            ball.y = startPos.y;
            ball.vx = 0;
            ball.vy = 0;
            ball.inAir = false;
            ball.dragging = false;
            justScored = false;
            ball.lastY = ball.y;
            render();
        }

        function updateScoreboard() {
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('shotsValue').textContent = shots;
        }

        function stepPhysics() {
            ball.lastY = ball.y;

            // Apply gravity
            ball.vy += gravity;
            ball.x += ball.vx;
            ball.y += ball.vy;

            // Ground collision
            if (ball.y + ballRadius >= groundY) {
                ball.y = groundY - ballRadius;
                ball.vy = -ball.vy * 0.35;
                ball.vx *= 0.9;
                if (Math.abs(ball.vy) < 0.8) {
                    ball.vy = 0;
                }
                if (Math.abs(ball.vx) < 0.3 && Math.abs(ball.vy) === 0) {
                    ball.inAir = false;
                }
                justScored = false; // allow next score once ball resets/lands
            }

            // Wall bounds
            if (ball.x - ballRadius < 0) {
                ball.x = ballRadius;
                ball.vx = -ball.vx * 0.4;
            }
            if (ball.x + ballRadius > canvas.width) {
                ball.x = canvas.width - ballRadius;
                ball.vx = -ball.vx * 0.4;
            }

            // Rim collision (simple rectangle)
            if (
                ball.x + ballRadius > rim.x &&
                ball.x - ballRadius < rim.x + rim.width &&
                ball.y + ballRadius > rim.y &&
                ball.y - ballRadius < rim.y + rim.thickness &&
                ball.vy > 0
            ) {
                ball.y = rim.y - ballRadius;
                ball.vy = -Math.abs(ball.vy) * 0.6;
            }

            // Scoring: ball passes through hoop area while moving downward
            const withinHoopX = ball.x > rim.x + 10 && ball.x < rim.x + rim.width - 10;
            const passedDownward = ball.lastY < rim.y && ball.y >= rim.y && ball.vy > 0;
            if (withinHoopX && passedDownward && !justScored) {
                score += 1;
                justScored = true;
                updateScoreboard();
            }
        }

        function render(mouseX = null, mouseY = null) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawCourt();
            drawAimLine(mouseX, mouseY);
            drawBall();
        }

        function gameLoop() {
            if (ball.inAir) {
                stepPhysics();
            }
            render();
            requestAnimationFrame(gameLoop);
        }

        // Mouse controls for aim and shoot
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const dist = Math.hypot(mouseX - ball.x, mouseY - ball.y);
            if (dist <= ballRadius + 8 && !ball.inAir) {
                ball.dragging = true;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!ball.dragging) return;
            const rect = canvas.getBoundingClientRect();
            render(e.clientX - rect.left, e.clientY - rect.top);
        });

        canvas.addEventListener('mouseup', (e) => {
            if (!ball.dragging) return;
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const dx = ball.x - mouseX;
            const dy = ball.y - mouseY;

            // Power scaling
            ball.vx = dx * 0.18;
            ball.vy = dy * 0.18;
            ball.inAir = true;
            ball.dragging = false;
            justScored = false;
            shots += 1;
            updateScoreboard();
        });

        // Touch support
        canvas.addEventListener('touchstart', (e) => {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const mouseX = touch.clientX - rect.left;
            const mouseY = touch.clientY - rect.top;
            const dist = Math.hypot(mouseX - ball.x, mouseY - ball.y);
            if (dist <= ballRadius + 12 && !ball.inAir) {
                ball.dragging = true;
                e.preventDefault();
            }
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            if (!ball.dragging) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            render(touch.clientX - rect.left, touch.clientY - rect.top);
            e.preventDefault();
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            if (!ball.dragging) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.changedTouches[0];
            const mouseX = touch.clientX - rect.left;
            const mouseY = touch.clientY - rect.top;
            const dx = ball.x - mouseX;
            const dy = ball.y - mouseY;
            ball.vx = dx * 0.18;
            ball.vy = dy * 0.18;
            ball.inAir = true;
            ball.dragging = false;
            justScored = false;
            shots += 1;
            updateScoreboard();
            e.preventDefault();
        }, { passive: false });

        // Init
        updateScoreboard();
        render();
        requestAnimationFrame(gameLoop);

        // -----------------------
        // DSE Math Calculator
        // -----------------------
        function formatNumber(value) {
            if (!isFinite(value)) return '∞';
            const abs = Math.abs(value);
            if (abs !== 0 && (abs < 0.001 || abs > 1e6)) {
                return value.toExponential(4);
            }
            return Number(value.toFixed(6)).toString();
        }

        function safeEval(expression) {
            const allowed = /^[0-9+\-*/%^().\s]+$/;
            if (!allowed.test(expression)) {
                throw new Error('Use digits, + - * / % ^ ( ) only.');
            }
            // Convert ^ to ** for exponent
            const sanitized = expression.replace(/\^/g, '**');
            // eslint-disable-next-line no-new-func
            return Function(`"use strict"; return (${sanitized});`)();
        }

        function evaluateExpression() {
            const exprInput = document.getElementById('calcExpression');
            const output = document.getElementById('calcResult');
            const raw = (exprInput.value || '').trim();
            if (!raw) {
                output.textContent = 'Enter an expression, e.g. 3*(5+2)^2 / 7';
                return;
            }
            try {
                const result = safeEval(raw);
                output.textContent = `Result: ${formatNumber(result)}`;
            } catch (err) {
                output.textContent = `Error: ${err.message}`;
            }
        }

        function clearExpression() {
            document.getElementById('calcExpression').value = '';
            document.getElementById('calcResult').textContent = 'Result will appear here.';
        }

        function factorial(n) {
            if (!Number.isInteger(n) || n < 0) throw new Error('n must be a non-negative integer');
            if (n > 170) throw new Error('n is too large ( >170 )');
            let res = 1;
            for (let i = 2; i <= n; i++) res *= i;
            return res;
        }

        function nPr(n, r) {
            if (r > n) throw new Error('r cannot exceed n');
            return factorial(n) / factorial(n - r);
        }

        function nCr(n, r) {
            if (r > n) throw new Error('r cannot exceed n');
            return factorial(n) / (factorial(r) * factorial(n - r));
        }

        function computeCombinatorics() {
            const n = Number(document.getElementById('combN').value);
            const r = Number(document.getElementById('combR').value);
            const output = document.getElementById('combResult');
            try {
                if (!Number.isInteger(n) || !Number.isInteger(r)) {
                    throw new Error('n and r must be integers');
                }
                if (n < 0 || r < 0) throw new Error('n and r must be non-negative');
                const comb = nCr(n, r);
                const perm = nPr(n, r);
                output.textContent = `nCr: ${formatNumber(comb)} | nPr: ${formatNumber(perm)}`;
            } catch (err) {
                output.textContent = `Error: ${err.message}`;
            }
        }

        function computePercentChange() {
            const base = Number(document.getElementById('percentBase').value);
            const change = Number(document.getElementById('percentChange').value);
            const output = document.getElementById('combResult');
            if (!isFinite(base) || !isFinite(change)) {
                output.textContent = 'Enter valid numbers for base and % change.';
                return;
            }
            const result = base * (1 + change / 100);
            output.textContent = `After ${change}% change: ${formatNumber(result)}`;
        }

        function cubicDiscriminant(a, b, c, d) {
            // Disc for ax^3 + bx^2 + cx + d
            const delta0 = b * b - 3 * a * c;
            const delta1 = 2 * b * b * b - 9 * a * b * c + 27 * a * a * d;
            return delta1 * delta1 - 4 * delta0 * delta0 * delta0;
        }

        function solveCubic() {
            const a = Number(document.getElementById('cubicA').value);
            const b = Number(document.getElementById('cubicB').value);
            const c = Number(document.getElementById('cubicC').value);
            const d = Number(document.getElementById('cubicD').value);
            const output = document.getElementById('cubicResult');

            if (![a, b, c, d].every(Number.isFinite)) {
                output.textContent = 'Enter numeric values for all coefficients.';
                return;
            }

            if (a === 0) {
                // Fallback to quadratic / linear
                if (b === 0) {
                    if (c === 0) {
                        output.textContent = d === 0 ? 'Infinite solutions.' : 'No solution.';
                    } else {
                        const root = -d / c;
                        output.textContent = `Linear: root x = ${formatNumber(root)}`;
                    }
                } else {
                    // Quadratic bx^2 + cx + d = 0
                    const disc = c * c - 4 * b * d;
                    if (disc >= 0) {
                        const sqrtD = Math.sqrt(disc);
                        const x1 = (-c + sqrtD) / (2 * b);
                        const x2 = (-c - sqrtD) / (2 * b);
                        output.textContent = `Quadratic roots: ${formatNumber(x1)}, ${formatNumber(x2)}`;
                    } else {
                        const sqrtD = Math.sqrt(-disc);
                        const real = -c / (2 * b);
                        const imag = sqrtD / (2 * b);
                        output.textContent = `Quadratic complex roots: ${formatNumber(real)} ± ${formatNumber(imag)}i`;
                    }
                }
                return;
            }

            // Normalize to monic: x^3 + px^2 + qx + r = 0
            const p = b / a;
            const q = c / a;
            const r = d / a;

            // Depressed cubic: t^3 + pt + q
            const a2 = p;
            const a1 = q;
            const a0 = r;
            const shift = a2 / 3;
            const pDep = a1 - (a2 * a2) / 3;
            const qDep = (2 * a2 * a2 * a2) / 27 - (a2 * a1) / 3 + a0;

            const disc = (qDep * qDep) / 4 + (pDep * pDep * pDep) / 27;

            function formatComplex(real, imag) {
                if (Math.abs(imag) < 1e-10) return formatNumber(real);
                const sign = imag >= 0 ? '+' : '-';
                return `${formatNumber(real)} ${sign} ${formatNumber(Math.abs(imag))}i`;
            }

            let roots = [];

            if (disc > 0) {
                // One real, two complex
                const sqrtDisc = Math.sqrt(disc);
                const u = Math.cbrt(-qDep / 2 + sqrtDisc);
                const v = Math.cbrt(-qDep / 2 - sqrtDisc);
                const realRoot = u + v - shift;

                const realPart = -(u + v) / 2 - shift;
                const imagPart = (u - v) * Math.sqrt(3) / 2;
                roots = [
                    formatNumber(realRoot),
                    formatComplex(realPart, imagPart),
                    formatComplex(realPart, -imagPart)
                ];
            } else if (Math.abs(disc) < 1e-12) {
                // Triple or double root
                const u = Math.cbrt(-qDep / 2);
                const root1 = 2 * u - shift;
                const root2 = -u - shift;
                roots = [
                    formatNumber(root1),
                    formatNumber(root2),
                    formatNumber(root2)
                ];
            } else {
                // Three real roots
                const phi = Math.acos(-qDep / 2 / Math.sqrt(-(pDep * pDep * pDep) / 27));
                const m = 2 * Math.sqrt(-pDep / 3);
                const r1 = m * Math.cos(phi / 3) - shift;
                const r2 = m * Math.cos((phi + 2 * Math.PI) / 3) - shift;
                const r3 = m * Math.cos((phi + 4 * Math.PI) / 3) - shift;
                roots = [formatNumber(r1), formatNumber(r2), formatNumber(r3)];
            }

            const delta = cubicDiscriminant(a, b, c, d);
            output.textContent = `Roots: ${roots.join(', ')} | discriminant Δ = ${formatNumber(delta)}`;
        }

        function clearCubic() {
            document.getElementById('cubicA').value = 1;
            document.getElementById('cubicB').value = -6;
            document.getElementById('cubicC').value = 11;
            document.getElementById('cubicD').value = -6;
            document.getElementById('cubicResult').textContent = 'Roots will appear here.';
        }

        function solveSimultaneous() {
            const a = Number(document.getElementById('simA').value);
            const b = Number(document.getElementById('simB').value);
            const c = Number(document.getElementById('simC').value);
            const d = Number(document.getElementById('simD').value);
            const e = Number(document.getElementById('simE').value);
            const f = Number(document.getElementById('simF').value);
            const output = document.getElementById('simResult');

            if (![a, b, c, d, e, f].every(Number.isFinite)) {
                output.textContent = 'Enter numeric values for all coefficients.';
                return;
            }

            const det = a * e - b * d;
            if (det === 0) {
                const altDetX = (-c) * e - b * (-f);
                const altDetY = a * (-f) - (-c) * d;
                if (altDetX === 0 && altDetY === 0) {
                    output.textContent = 'Infinite solutions (dependent equations).';
                } else {
                    output.textContent = 'No solution (inconsistent equations).';
                }
                return;
            }

            // System: ax + by = -c and dx + ey = -f
            const x = ((-c) * e - b * (-f)) / det;
            const y = (a * (-f) - (-c) * d) / det;
            output.textContent = `x = ${formatNumber(x)}, y = ${formatNumber(y)} | det = ${formatNumber(det)}`;
        }

        function clearSimultaneous() {
            document.getElementById('simA').value = 1;
            document.getElementById('simB').value = 2;
            document.getElementById('simC').value = 3;
            document.getElementById('simD').value = 4;
            document.getElementById('simE').value = 5;
            document.getElementById('simF').value = 6;
            document.getElementById('simResult').textContent = 'Solutions x, y will appear here.';
        }

        function solveQuadratic() {
            const a = Number(document.getElementById('quadA').value);
            const b = Number(document.getElementById('quadB').value);
            const c = Number(document.getElementById('quadC').value);
            const output = document.getElementById('quadResult');

            if (!isFinite(a) || !isFinite(b) || !isFinite(c)) {
                output.textContent = 'Enter numeric values for a, b, and c.';
                return;
            }

            if (a === 0) {
                if (b === 0) {
                    output.textContent = c === 0 ? 'Infinite solutions.' : 'No solution.';
                    return;
                }
                const root = -c / b;
                output.textContent = `Linear equation. Root: x = ${formatNumber(root)}`;
                return;
            }

            const disc = b * b - 4 * a * c;
            if (disc > 0) {
                const sqrtD = Math.sqrt(disc);
                const x1 = (-b + sqrtD) / (2 * a);
                const x2 = (-b - sqrtD) / (2 * a);
                output.textContent = `Discriminant: ${formatNumber(disc)}\nRoots: x₁ = ${formatNumber(x1)}, x₂ = ${formatNumber(x2)}`;
            } else if (disc === 0) {
                const x = -b / (2 * a);
                output.textContent = `Discriminant: 0\nRepeated root: x = ${formatNumber(x)}`;
            } else {
                const sqrtD = Math.sqrt(-disc);
                const real = -b / (2 * a);
                const imag = sqrtD / (2 * a);
                output.textContent = `Discriminant: ${formatNumber(disc)} (negative)\nComplex roots: ${formatNumber(real)} ± ${formatNumber(imag)}i`;
            }
        }
    </script>
</body>
</html>

